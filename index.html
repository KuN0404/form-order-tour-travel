<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>Formulir Order Tour & Travel</title>
  </head>
  <body class="bg-dark bg-opacity-75">
    <!-- Background image layer -->
    <div
      class="position-fixed top-0 start-0 w-100 h-100"
      style="background-image: url('background.jpg'); background-size: cover; background-position: center; background-repeat: no-repeat; z-index: 0; filter: brightness(0.5); /* bikin agak gelap */"></div>

    <!-- Form Container -->
    <div class="container py-5 position-relative z-1">
      <div class="card shadow-lg rounded-4 border-0 bg-white">
        <div class="card-body p-5">
          <h2 class="mb-4 fw-semibold text-center">Formulir Order Tour & Travel</h2>
          <form id="contactForm" class="row g-4">
            <!-- Tanggal Keberangkatan -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="date" class="form-control" id="tgl_keberangkatan" name="tgl_keberangkatan" placeholder="Tanggal Keberangkatan" required />
                <label for="tgl_keberangkatan">Tanggal Keberangkatan</label>
              </div>
            </div>

            <!-- Penyewa -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="penyewa" name="penyewa" placeholder="Nama Penyewa" required />
                <label for="penyewa">Penyewa</label>
              </div>
            </div>

            <!-- no_hp -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="no_hp" name="no_hp" placeholder="Masukan No HP" required />
                <label for="no_hp">No HP</label>
              </div>
            </div>

            <!-- penjemputan -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="penjemputan" name="penjemputan" placeholder="Lokasi Penjemputan" required />
                <label for="penjemputan">Lokasi Penjemputan</label>
              </div>
            </div>

            <!-- jam Penjemputan -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="time" class="form-control" id="jam_penjemputan" name="jam_penjemputan" placeholder="Jam Penjemputan" required />
                <label for="jam_penjemputan">Jam Penjemputan</label>
              </div>
            </div>

            <!-- Tujuan -->
            <div class="col-md-6">
              <div class="form-floating">
                <select class="form-select" name="tujuan" aria-label="Default select example">
                  <option selected>--------</option>
                  <option value="Pantai">Pantai</option>
                  <option value="Jiarah Wali Songo">Jiarah Wali Songo</option>
                  <option value="Study Tour">Study Tour</option>
                  <option value="Drop">Drop</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
                <label for="tujuan">Tujuan</label>
              </div>
            </div>

            <!-- Mobil -->
            <div class="col-md-6">
              <div class="form-floating">
                <select class="form-select" name="mobil" aria-label="Default select example">
                  <option selected>--------</option>
                  <option value="Haice 14s">Haice 14s</option>
                  <option value="Medium Bus 35s">Medium Bus 35s</option>
                  <option value="Big Bus 50s">Big Bus 50s</option>
                  <option value="Big Bus 60s">Big Bus 60s</option>
                </select>
                <label for="mobil">Mobil</label>
              </div>
            </div>

            <!-- Lama Sewa -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="lama_sewa" name="lama_sewa" placeholder="Lama Sewa" required />
                <label for="lama_sewa">Lama Sewa</label>
              </div>
            </div>

            <!-- DP -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="dp" name="dp" placeholder="dp" required />
                <label for="dp">DP</label>
              </div>
            </div>

            <!-- Sisa -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="sisa" name="jml_sisa" placeholder="sisa" required />
                <label for="sisa">Sisa</label>
              </div>
            </div>

            <!-- Asuransi -->
            <div class="col-md-6">
              <p>Asuransi?</p>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="is_asuransi" id="isAsuransi1" />
                <label class="form-check-label" for="isAsuransi1"> Ya </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="is_asuransi" id="isAsuransi2" checked />
                <label class="form-check-label" for="isAsuransi2"> Tidak </label>
              </div>
            </div>
            <!-- Catatan -->
            <div class="col-12">
              <div class="form-floating">
                <textarea class="form-control" id="catatan" name="catatan" placeholder="Catatan" style="height: 120px" required></textarea>
                <label for="catatan">Catatan</label>
              </div>
            </div>

            <!-- Submit -->
            <div class="col-12 d-grid mt-4">
              <button type="submit" id="submitButton" class="btn btn-primary btn-lg rounded-pill shadow-sm">Kirim Form</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById('contactForm');
      const submitButton = document.getElementById('submitButton');

      // Format angka ke format "1.000.000"
      function formatRupiah(angka) {
        return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      }

      // Hapus titik dan parsing ke integer
      function parseRupiah(rp) {
        return parseInt(rp.replace(/\./g, '')) || 0;
      }

      function setupRupiahInput(id) {
        const input = document.getElementById(id);

        input.addEventListener('input', () => {
          const raw = input.value.replace(/\D/g, '');
          input.value = formatRupiah(raw);
          updateTotals();
        });

        input.addEventListener('keypress', (e) => {
          if (!/[0-9]/.test(String.fromCharCode(e.which))) {
            e.preventDefault();
          }
        });
      }

      // Input uang
      const uangInputs = ['dp', 'sisa'];
      uangInputs.forEach(setupRupiahInput);

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const confirm = await Swal.fire({
          title: 'Apakah Anda yakin?',
          text: 'Data akan dikirim!',
          icon: 'question',
          showCancelButton: true,
          confirmButtonText: 'Ya, kirim',
          cancelButtonText: 'Batal',
        });

        if (!confirm.isConfirmed) return;

        submitButton.disabled = true;
        submitButton.textContent = 'Mengirim...';

        // Format ulang semua input uang agar hanya berupa angka mentah
        uangInputs.forEach((id) => {
          const el = document.getElementById(id);
          el.value = parseRupiah(el.value);
        });

        try {
          const formData = new FormData(form);
          const data = new URLSearchParams(formData);

          const response = await fetch('https://script.google.com/macros/s/AKfycbwMYDFbqlqHOBZm1PBBcZYOe-F3Mpk5uadoHMbRAthYeNzElPENfmqtJ8LTuZcKTaRM/exec', {
            method: 'POST',
            body: data,
          });

          const result = await response.json();

          if (result.result === 'success') {
            await Swal.fire({
              icon: 'success',
              title: 'Berhasil!',
              text: '✅ Data berhasil dikirim.',
              confirmButtonText: 'OK',
            });
            form.reset();
            updateTotals();
          } else {
            throw new Error(result.error);
          }
        } catch (error) {
          console.error(error);
          await Swal.fire({
            icon: 'error',
            title: 'Terjadi Kesalahan',
            text: '❌ Tidak dapat mengirim data. Silakan coba lagi.',
            confirmButtonText: 'OK',
          });
        }

        setTimeout(() => {
          submitButton.disabled = false;
          submitButton.textContent = 'Submit';
        }, 3000);
      });

      // Inisialisasi awal
      updateTotals();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.min.js" integrity="sha384-VQqxDN0EQCkWoxt/0vsQvZswzTHUVOImccYmSyhJTp7kGtPed0Qcx8rK9h9YEgx+" crossorigin="anonymous"></script>
  </body>
</html>
